# Migración 

::: {style="text-align: justify"}
```{r}
#| label: packages
#| echo: false

pacman::p_load(
  dplyr, haven, sjlabelled,  psych,  purrr,  tidyr,  sjPlot,  ggplot2, 
  parameters,  table1,  car,  beeswarm, scales, ggrepel, corrplot,
  ggtext, patchwork, psych, kableExtra)
```

```{r}
#| label: database ola 1
#| echo: false 

elsoc_1 <- readRDS("../../input/data/proc_data/elsoc_2016_mig.RData")
```

```{r}
#| label: database ola 2
#| echo: false 

elsoc_2 <- readRDS("../../input/data/proc_data/elsoc_2017_mig.RData")
```

```{r}
#| label: database ola 3 
#| echo: false 

elsoc_3 <- readRDS("../../input/data/proc_data/elsoc_2018_mig.RData")
```

```{r}
#| label: database ola 4
#| echo: false 

elsoc_4 <- readRDS("../../input/data/proc_data/elsoc_2019_mig.RData")
```

```{r}
#| label: database ola 5
#| echo: false 

elsoc_5 <- readRDS("../../input/data/proc_data/elsoc_2021_mig.RData")
```

```{r}
#| label: database ola 6
#| echo: false 

elsoc_6 <- readRDS("../../input/data/proc_data/elsoc_2022_mig.RData")
```

```{r}
#| label: data-full
#| echo: false

# Agregar la variable ola a cada base
elsoc_1 <- elsoc_1 %>% mutate(ola = 1)
elsoc_2 <- elsoc_2 %>% mutate(ola = 2)
elsoc_3 <- elsoc_3 %>% mutate(ola = 3)
elsoc_4 <- elsoc_4 %>% mutate(ola = 4)
elsoc_4 <- elsoc_4 %>% mutate(ola = 4)
elsoc_5 <- elsoc_5 %>% mutate(ola = 5)
elsoc_6 <- elsoc_6 %>% mutate(ola = 6)

# Unir todas las olas en una sola base
elsoc_long <- bind_rows(elsoc_1, elsoc_2, elsoc_3, elsoc_4, elsoc_5, elsoc_6)
```


# Migración en Chile: Percepciones, desafíos y oportunidades

De acuerdo con los resultados del CENSO 2024, la población nacida fuera de Chile asciende a aproximadamente 1,6 millones de personas. Esta cifra representa un 8.8% de la población total residente en el país, lo que duplica el porcentaje de 4.4% registrado en el censo anterior de 2017.

Del total de inmigrantes internacionales, 508.178 llegaron al país antes de 2017, mientras que 1.085.538 lo hicieron a partir de ese año. El mayor flujo migratorio se concentró en el período 2017-2019, con cifras anuales de 10,4% en 2017, 12,4% en 2018 y 10,7% en 2019 del total de personas migrantes que declararon su año de ingreso (CENSO, 2024). Este proceso se caracteriza por un predominio de mujeres (51,7%) y una concentración etaria entre los 30 y 39 años. En cuanto al origen nacional, destacan principalmente las personas provenientes de Venezuela (41,6%), seguidas por aquellas de Perú (14,5%) y Colombia (12,3%) (CENSO, 2024). 

Los niveles y formas de cohesión social en Chile se encuentran estrechamente vinculados a los procesos migratorios. En este contexto, la migración se ha posicionado como un eje central de la agenda pública, no solo en términos administrativos, sino también como un factor de tensión social. El cambio abrupto en la magnitud y la composición de los flujos migratorios ha desafiado los patrones de interacción social y ha puesto a prueba los marcos institucionales disponibles para gestionar este fenómeno (Lang et al., 2024). Este escenario ha generado un periodo de adaptación inestable entre migrantes y población local, en el que la inclusión social se ve dificultada por la rapidez y densidad del cambio (Lang et al., 2024). 

En consecuencia, las percepciones ciudadanas hacia los migrantes recientes se caracterizan por una fuerte ambivalencia: mientras una mayoría de chilenos (74%) y migrantes previos (72%) declara una visión negativa respecto de quienes llegaron en los últimos cinco años (CEP, 2024), también se reconoce a este grupo como trabajadores y honestos, aunque simultáneamente se les asocie con delincuencia o falta de respeto a las costumbres locales.

La evidencia muestra que estas percepciones contradictorias dependen fuertemente de la experiencia individual y contingente de la interacción, de modo que el mismo espacio —la calle, el barrio o el trabajo— puede ser escenario tanto de relaciones positivas como negativas (CEP, 2024). La falta de anclajes institucionales y discursivos que otorguen estabilidad a estas experiencias refuerza la polarización y la incertidumbre, situando a los migrantes recientes como objeto de juicios extremos, ya sea positivos o negativos (Lang et al., 2024).

La macrozona norte del país es un caso particularmente relevante, dado que concentra una alta densidad de población migrante (CENSO, 2024) y enfrenta un contacto cotidiano más frecuente con ellos (INE, 2022). No obstante, contrariamente a lo sugerido por la literatura sobre contacto intergrupal, que indica que la interacción sostenida tiende a reducir prejuicios (Voci & Hewstone, 2003; Paolini et al., 2014), en esta zona se observa una asociación significativa entre mayor exposición y percepciones más negativas, especialmente en aspectos normativos como el respeto a las leyes o a las costumbres chilenas (CEP, 2024). Este hallazgo coincide con tesis como la de Putnam (2007), quien advierte que la diversidad puede generar actitudes hostiles en el corto plazo, antes de que se consoliden procesos de integración.

```{r}
#| label: fig-mig1
#| fig-cap: Tendencia de variables sobre migración ELSOC (2016-2019)
#| warning: false
#| message: false
#| echo: false

# Variables a graficar
vars <- c("igualdad_migrantes", "contacto_migrantes", "simpatia_migrantes", "perdida_identidad", "desempleo_migrantes")

# Calcular promedios por ola en formato long
long_promedio <- elsoc_long %>%
  select(ola, all_of(vars)) %>%
  pivot_longer(cols = all_of(vars), 
               names_to = "variable", 
               values_to = "valor") %>%
  group_by(ola, variable) %>%
  summarise(promedio = mean(valor, na.rm = TRUE), .groups = "drop")

# Nombres más legibles para la leyenda y facets
nombres_legibles <- c(
  "igualdad_migrantes" = "Acceso a \n Salud Migrantes",
  "contacto_migrantes" = "Contacto Positivo \n con Migrantes",
  "simpatia_migrantes" = "Simpatía \n hacia migrantes",
  "perdida_identidad" = "Pérdida de \n identidad",
  "desempleo_migrantes" = "Desempleo percibido \n por migrantes"
)

# Asegurarse que ola sea numérica y esté completa de 1 a 6
olas_completas <- tibble(ola = 1:6)

# Unir con tus datos (esto fuerza a que aparezcan todas las olas en el eje)
long_promedio <- long_promedio %>%
  right_join(olas_completas, by = "ola")

# Ordenar para seguridad
long_promedio <- long_promedio %>%
  arrange(variable, ola)

# Vector con años correspondientes a cada ola
anos_olas <- c("2016", "2017", "2018", "2019", "2022", "2023")

# Graficar
ggplot(long_promedio, aes(x = ola, y = promedio, color = variable, group = variable, shape = variable)) +
    geom_line(linewidth = 1.2, na.rm = FALSE) +
    geom_point(size = 3, na.rm = FALSE) +
      scale_color_manual(values = c(
      "igualdad_migrantes"   = "#7aba21",
      "contacto_migrantes"   = "#f9913d",
      "simpatia_migrantes"   = "#2b2f3c",
      "perdida_identidad"    = "#824293",
      "desempleo_migrantes"  = "#487fd3"
  ),
  labels = nombres_legibles) +
  scale_shape_manual(values = c(
    "igualdad_migrantes"   = 16, 
    "contacto_migrantes"   = 17, 
    "simpatia_migrantes"   = 15, 
    "perdida_identidad"    = 18, 
    "desempleo_migrantes"  = 19   
  ),
  labels = nombres_legibles) +
  scale_x_continuous(breaks = 1:6,
                      label = anos_olas) + 
  scale_y_continuous(limits = c(1, 5), breaks = 1:5) +
  labs(title = "Tendencia de variables sobre migración (ELSOC 2016-2022)",
       x = "Ola", y = "Promedio", color = "Variable", shape = "Variable") +
  theme_minimal() +
  theme(
    strip.text = element_text(size = 12, face = "bold"),
    legend.box.background = element_rect(color = "grey20", fill = "white", linewidth = 0.5),
    legend.background     = element_rect(fill = "white", color = NA),
    legend.margin         = margin(t = 6, r = 8, b = 6, l = 8),
    legend.box.margin     = margin(t = 6, r = 6, b = 6, l = 6),
    
    legend.position       = "bottom",
    legend.direction      = "horizontal",
    legend.box            = "horizontal",
    
    legend.title          = element_text(face = "bold"),
    legend.key            = element_rect(fill = "white", color = NA),
    legend.key.height     = unit(12, "pt"),
    legend.key.width      = unit(20, "pt"),
    
    axis.text  = element_text(size = 11),
    panel.spacing = unit(1, "cm")   # mantiene separación entre paneles
  ) +
  guides(color = guide_legend(
    title.position = "top",
    label.position = "bottom",
    nrow = 1, byrow = TRUE,
    keywidth = unit(14, "pt"),
    keyheight = unit(10, "pt")
  ),
  shape = guide_legend(
    title.position = "top",
    label.position = "right",
    nrow = 1, byrow = TRUE,
    keywidth = unit(14, "pt"),
    keyheight = unit(10, "pt")
  ))
```

Por su parte, los resultados de la Encuesta ELSOC del Centro de Estudios de Conflicto y Cohesión Social (COES) permiten observar tendencias relevantes en las percepciones ciudadanas hacia la migración en Chile entre 2016 y 2022. En la [@fig-mig1], que muestra la evolución del promedio de distintas variables que remiten a la percepción respecto a la población migrante, se aprecia una relativa estabilidad a lo largo del período, aunque con matices importantes. El contacto positivo con migrantes se mantiene en niveles altos y constantes, lo que refleja una persistencia en la valoración favorable de las experiencias de interacción. En contraste, el desempleo atribuido a la migración muestra una leve tendencia a la baja, lo que sugiere una disminución en la asociación entre presencia migrante y pérdida de empleo. Algo similar ocurre con la percepción sobre el acceso de migrantes a la salud, que aparece en las olas más recientes con niveles elevados pero con una ligera caída. En el caso de la pérdida de identidad, las respuestas se mantienen estables en niveles bajos, indicando que este temor cultural no alcanza gran prevalencia. La simpatía hacia migrantes, en tanto, se sitúa en valores intermedios, con oscilaciones menores a lo largo de las olas.

```{r}
#| label: fig-mig2
#| fig-cap: Distribución simplificada de respuestas ELSOC (2016-2019)
#| echo: false

# Variables a graficar (solo 2)
vars <- c("contacto_migrantes", "simpatia_migrantes")

# Nombres más legibles
nombres_legibles <- c("contacto_migrantes" = "Contacto positivo migrantes",
  "simpatia_migrantes" = "Simpatía hacia migrantes"
)

# Convertir a formato largo y recodificar respuestas
long_data <- elsoc_long %>%
  select(ola, all_of(vars)) %>%
  pivot_longer(cols = all_of(vars), names_to = "variable", values_to = "valor") %>%
  filter(!is.na(valor)) %>%
  mutate(respuesta = case_when(
    valor %in% c(1, 2) ~ "Bajo (1-2)",
    valor == 3 ~ "Medio (3)",
    valor %in% c(4, 5) ~ "Alto (4-5)"
  ),
  respuesta = factor(respuesta, levels = c("Bajo (1-2)", "Medio (3)", "Alto (4-5)")))

# Calcular proporciones
freq_data <- long_data %>%
  group_by(ola, variable, respuesta) %>%
  summarise(freq = n(), .groups = "drop") %>%
  group_by(ola, variable) %>%
  mutate(prop = freq / sum(freq))

# Gráfico de barras apiladas con formato de leyenda personalizado
ggplot(freq_data, aes(x = factor(ola), y = prop, fill = respuesta)) +
  geom_bar(stat = "identity", position = position_stack(reverse = TRUE)) +
  facet_wrap(~variable, ncol = 3, labeller = labeller(variable = nombres_legibles)) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  scale_x_discrete(labels = c("1" = "2016",
                              "2" = "2017", 
                              "3" = "2018",
                              "4" = "2019",
                              "5" = "2022",
                              "6" = "2023")) +
  scale_fill_manual(values = c("Bajo (1-2)" = "#f9913d",  
                               "Medio (3)" = "#7aba21",   
                               "Alto (4-5)" = "#2b2f3c"),
                    labels = c("Bajo (1-2)" = "Bajo",  
                               "Medio (3)" = "Medio",   
                               "Alto (4-5)" = "Alto"),
                    name = "Respuesta",
                    breaks = c("Bajo (1-2)", "Medio (3)", "Alto (4-5)")) +
  labs(title = "Distribución simplificada de respuestas (ELSOC 2016-2023)",
       x = "Ola", y = "Porcentaje") +
  theme_minimal() +
  theme(
    strip.text = element_text(size = 12, face = "bold"),
    legend.box.background = element_rect(color = "grey20", fill = "white", linewidth = 0.5),
    legend.background     = element_rect(fill = "white", color = NA),
    legend.margin         = margin(t = 6, r = 8, b = 6, l = 8),
    legend.box.margin     = margin(t = 6, r = 6, b = 6, l = 6),
    
    legend.position       = "bottom",
    legend.direction      = "horizontal",
    legend.box            = "horizontal",
    
    legend.title          = element_text(face = "bold"),
    legend.key            = element_rect(fill = "white", color = NA),
    legend.key.height     = unit(12, "pt"),
    legend.key.width      = unit(20, "pt"),
    
    axis.text  = element_text(size = 11),
    panel.spacing = unit(1, "cm")   # mantiene separación entre paneles
  ) +
  guides(fill = guide_legend(
    title.position = "top",
    label.position = "right",
    nrow = 1, byrow = TRUE,
    keywidth = unit(14, "pt"),
    keyheight = unit(10, "pt")
  ))
```
En la @fig-mig2, que desagrega las respuestas en tres categorías simplificadas (bajo, medio y alto), permite observar con mayor detalle cómo se distribuyen las actitudes hacia el contacto y la simpatía. En el caso del contacto positivo con migrantes, predomina de manera clara la categoría alta, con proporciones superiores al 50% en todas las olas y escasa presencia de respuestas bajas, lo que confirma que la mayoría de la población declara experiencias favorables de interacción. La simpatía hacia migrantes, en cambio, presenta un escenario más heterogéneo: si bien las respuestas altas siguen siendo relevantes, en las olas más recientes se advierte un incremento de las respuestas bajas, lo que refleja un aumento en las percepciones de rechazo o menor simpatía.

```{r}
#| label: fig-mig3
#| fig-cap: Distribución simplificada de respuestas (ELSOC 2016-2019
#| echo: false

# Variables a graficar (las 2 restantes)
vars <- c("perdida_identidad", "desempleo_migrantes")

# Nombres más legibles
nombres_legibles <- c(
  "perdida_identidad" = "Pérdida de identidad",
  "desempleo_migrantes" = "Desempleo percibido por migrantes"
)

# Convertir a formato largo y recodificar respuestas
long_data <- elsoc_long %>%
  select(ola, all_of(vars)) %>%
  pivot_longer(cols = all_of(vars), names_to = "variable", values_to = "valor") %>%
  filter(!is.na(valor)) %>%
  mutate(respuesta = case_when(
    valor %in% c(1, 2) ~ "Bajo (1-2)",
    valor == 3 ~ "Medio (3)",
    valor %in% c(4, 5) ~ "Alto (4-5)"
  ),
  respuesta = factor(respuesta, levels = c("Bajo (1-2)", "Medio (3)", "Alto (4-5)")))

# Calcular proporciones
freq_data <- long_data %>%
  group_by(ola, variable, respuesta) %>%
  summarise(freq = n(), .groups = "drop") %>%
  group_by(ola, variable) %>%
  mutate(prop = freq / sum(freq))

# Gráfico de barras apiladas
ggplot(freq_data, aes(x = factor(ola), y = prop, fill = respuesta)) +
  geom_bar(stat = "identity", position = position_stack(reverse = TRUE)) +
  facet_wrap(~variable, ncol = 2, labeller = labeller(variable = nombres_legibles)) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  scale_x_discrete(labels = c("1" = "2016",
                              "2" = "2017", 
                              "3" = "2018",
                              "4" = "2019",
                              "5" = "2022",
                              "6" = "2023")) + 
  scale_fill_manual(values = c("Bajo (1-2)" = "#f9913d",  
                               "Medio (3)" = "#7aba21",   
                               "Alto (4-5)" = "#2b2f3c"),
                    labels = c("Bajo (1-2)" = "Bajo",  
                               "Medio (3)" = "Medio",   
                               "Alto (4-5)" = "Alto"),
                    name = "Respuesta",
                    breaks = c("Bajo (1-2)", "Medio (3)", "Alto (4-5)")) +
  labs(title = "Distribución simplificada de respuestas (ELSOC 2016-2023)",
       x = "Ola", y = "Porcentaje") +
  theme_minimal() +
  theme(
    strip.text = element_text(size = 12, face = "bold"),
    legend.box.background = element_rect(color = "grey20", fill = "white", linewidth = 0.5),
    legend.background     = element_rect(fill = "white", color = NA),
    legend.margin         = margin(t = 6, r = 8, b = 6, l = 8),
    legend.box.margin     = margin(t = 6, r = 6, b = 6, l = 6),
    
    legend.position       = "bottom",
    legend.direction      = "horizontal",
    legend.box            = "horizontal",
    
    legend.title          = element_text(face = "bold"),
    legend.key            = element_rect(fill = "white", color = NA),
    legend.key.height     = unit(12, "pt"),
    legend.key.width      = unit(20, "pt"),
    
    axis.text  = element_text(size = 11),
    panel.spacing = unit(1, "cm")   # mantiene separación entre paneles
  ) +
  guides(fill = guide_legend(
    title.position = "top",
    label.position = "right",
    nrow = 1, byrow = TRUE,
    keywidth = unit(14, "pt"),
    keyheight = unit(10, "pt")
  ))

```
La @fig-mig3, que aborda las percepciones críticas vinculadas a desempleo y pérdida de identidad, muestra que la primera es la creencia negativa más extendida. En todas las olas, la mayoría de los encuestados se concentra en la categoría alta, lo que indica que persiste una asociación fuerte entre migración y desempleo en la opinión pública. La pérdida de identidad, en cambio, aparece como un fenómeno más dividido: aunque existe una proporción importante que lo percibe en niveles altos, también se mantiene un grupo significativo en la categoría baja, lo que evidencia una menor uniformidad en este tipo de percepciones culturales en comparación con las económicas.

```{r}
#| label: fig-mig4
#| fig-cap: Tendencia Variables Igualdad Migrantes
#| echo: false

# Variables a graficar (las 2 restantes)
vars <- c("igualdad_migrantes")

# Nombres más legibles
nombres_legibles <- c(
    "igualdad_migrantes" = "Acceso de Salud Igualitario Migrantes"
)

# Convertir a formato largo y recodificar respuestas
long_data <- elsoc_long %>%
  select(ola, all_of(vars)) %>%
  pivot_longer(cols = all_of(vars), names_to = "variable", values_to = "valor") %>%
  filter(!is.na(valor)) %>%
  mutate(respuesta = case_when(
    valor %in% c(1, 2) ~ "Bajo (1-2)",
    valor == 3 ~ "Medio (3)",
    valor %in% c(4, 5) ~ "Alto (4-5)"
  ),
  respuesta = factor(respuesta, levels = c("Bajo (1-2)", "Medio (3)", "Alto (4-5)")))

# Calcular proporciones
freq_data <- long_data %>%
  group_by(ola, variable, respuesta) %>%
  summarise(freq = n(), .groups = "drop") %>%
  group_by(ola, variable) %>%
  mutate(prop = freq / sum(freq))

# Gráfico de barras apiladas
ggplot(freq_data, aes(x = factor(ola), y = prop, fill = respuesta)) +
  geom_bar(stat = "identity", position = position_stack(reverse = TRUE)) +
  facet_wrap(~variable, ncol = 2, labeller = labeller(variable = nombres_legibles)) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  scale_x_discrete(labels = c("1" = "2016",
                              "2" = "2017", 
                              "3" = "2018",
                              "4" = "2019",
                              "5" = "2022",
                              "6" = "2023")) +
  scale_fill_manual(values = c("Bajo (1-2)" = "#f9913d",  
                               "Medio (3)" = "#7aba21",   
                               "Alto (4-5)" = "#2b2f3c"),
                    labels = c("Bajo (1-2)" = "Bajo",  
                               "Medio (3)" = "Medio",   
                               "Alto (4-5)" = "Alto"),
                    name = "Respuesta",
                    breaks = c("Bajo (1-2)", "Medio (3)", "Alto (4-5)")) +
  labs(title = "Distribución simplificada de respuestas (ELSOC 2016-2023)",
       x = "Ola", y = "Porcentaje") +
  theme_minimal() +
  theme(
    strip.text = element_text(size = 12, face = "bold"),
    legend.box.background = element_rect(color = "grey20", fill = "white", linewidth = 0.5),
    legend.background     = element_rect(fill = "white", color = NA),
    legend.margin         = margin(t = 6, r = 8, b = 6, l = 8),
    legend.box.margin     = margin(t = 6, r = 6, b = 6, l = 6),
    
    legend.position       = "bottom",
    legend.direction      = "horizontal",
    legend.box            = "horizontal",
    
    legend.title          = element_text(face = "bold"),
    legend.key            = element_rect(fill = "white", color = NA),
    legend.key.height     = unit(12, "pt"),
    legend.key.width      = unit(20, "pt"),
    
    axis.text  = element_text(size = 11),
    panel.spacing = unit(1, "cm")   # mantiene separación entre paneles
  ) +
  guides(fill = guide_legend(
    title.position = "top",
    label.position = "right",
    nrow = 1, byrow = TRUE,
    keywidth = unit(14, "pt"),
    keyheight = unit(10, "pt")
  ))
```
Finalmente, la @fig-mig4, que muestra la opinión sobre el acceso de las personas migrantes a un sistema de salud en condiciones de igualdad, evidencia que en todas las olas la mayoría se ubica en la categoría alta, lo que indica un amplio acuerdo con esta idea. No obstante, también se observa un aumento sostenido en el grupo que manifiesta rechazo, lo que sugiere un progresivo crecimiento de la oposición a este principio de igualdad en el acceso a la salud. 

:::
